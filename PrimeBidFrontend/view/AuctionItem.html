<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fill Details</title>
    <link rel="stylesheet" href="css/AuctionItem.css">
</head>
<body>
    <div class="container">
        <div class="form-header">
            <button class="back-button" onclick="goBack()">&larr;</button>
            <h1>Fill Details</h1>
        </div>
        <form id="auction-item-form">
            <div class="form-group">
                <label for="product-name">Product Name</label>
                <input type="text" id="product-name" placeholder="iPhone 11" required>
            </div>

            <div class="form-group">
                <label for="category">Auction Category</label>
                <input type="text" id="category" placeholder="Electronic" required>
            </div>

            <div class="form-group">
                <label for="item-description">Item Description</label>
                <textarea id="item-description" placeholder="Enter a description" required></textarea>
            </div>

            <div class="form-group">
                <label for="starting-bid">Starting Bid</label>
                <input type="number" id="starting-bid" placeholder="100" required min="1">
            </div>

            <div class="form-group">
                <label for="auction-duration">Auction Duration (days)</label>
                <input type="number" id="auction-duration" placeholder="7" required min="1">
            </div>

            <div class="form-group">
                <label for="additional-terms">Additional Terms and Conditions</label>
                <textarea id="additional-terms" placeholder="Enter any additional terms..."></textarea>
            </div>

            <div class="form-buttons">
                <button type="button" class="cancel-button" onclick="cancel()">Cancel</button>
                <button type="submit" class="post-button">Next</button>
            </div>
        </form>
    </div>
    <script>
        document.getElementById('auction-item-form').addEventListener('submit', async function (event) {
            event.preventDefault();
        
            // Collect form data and parse necessary fields
            const data = {
                productName: document.getElementById('product-name').value.trim(),
                category: document.getElementById('category').value.trim(),
                ItemDescription: document.getElementById('item-description').value.trim(), // Update property name
                StartingBid: parseFloat(document.getElementById('starting-bid').value),  // Parse as float
                AuctionDuration: parseInt(document.getElementById('auction-duration').value),   // Update property name
                AdditionalTerms: document.getElementById('additional-terms').value.trim() // Update property name
            };
        
            console.log("Data to be sent:", data);  // Log data for verification
        
            // Check for required fields
            if (!data.productName || !data.category || !data.ItemDescription || isNaN(data.StartingBid) || isNaN(data.AuctionDuration)) {
                alert("Please fill in all required fields correctly.");
                return;
            }
        
            try {
                const response = await fetch("https://localhost:7217/api/AuctionItem", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });
        
                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("Error Response:", errorData);
                    console.error("Status:", response.status, "Status Text:", response.statusText);
                    alert(`Failed to submit auction item. Status: ${response.status}, Error: ${errorData.title || "Unknown error"}`);
                } else {
                    const responseData = await response.json();
                    console.log("Success:", responseData);
                    alert("Auction item created successfully!");
                    window.location.href = "Addpic.html"; // Redirect to Addpic.html
                }
            } catch (error) {
                console.error("Fetch Error:", error);
                alert("An error occurred. Please check the console for details.");
            }
        });
        
        function goBack() {
            window.history.back(); // Navigates to the previous page
        }
        
        function cancel() {
            document.getElementById('auction-item-form').reset(); // Resets the form
        }
    </script>
    
    
</body>
</html>
